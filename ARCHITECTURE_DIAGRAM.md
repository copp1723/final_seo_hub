# ğŸ—ï¸ Analytics System Architecture

## System Overview Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Frontend Layer                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   Overview Tab  â”‚  â”‚  Traffic Tab    â”‚  â”‚ Search Console  â”‚                 â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚      Tab        â”‚                 â”‚
â”‚  â”‚ â€¢ Total Sessionsâ”‚  â”‚ â€¢ Traffic Trendsâ”‚  â”‚ â€¢ Search Queriesâ”‚                 â”‚
â”‚  â”‚ â€¢ Unique Users  â”‚  â”‚ â€¢ Top Pages     â”‚  â”‚ â€¢ Page Rankings â”‚                 â”‚
â”‚  â”‚ â€¢ Organic Data  â”‚  â”‚ â€¢ Traffic Srcs  â”‚  â”‚ â€¢ CTR & Positionâ”‚                 â”‚
â”‚  â”‚ â€¢ Combined Chartâ”‚  â”‚ â€¢ GA4 Charts    â”‚  â”‚ â€¢ SC Charts     â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         State Management                                    â”‚ â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  â€¢ gaData: AnalyticsData                                                   â”‚ â”‚
â”‚  â”‚  â€¢ scData: SearchConsoleData                                               â”‚ â”‚
â”‚  â”‚  â€¢ selectedDealership: Context                                             â”‚ â”‚
â”‚  â”‚  â€¢ selectedRange: '7days' | '30days' | '3months'                          â”‚ â”‚
â”‚  â”‚  â€¢ loading, error states                                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                               API Layer                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   /api/ga4/analyticsâ”‚              â”‚/api/search-console/ â”‚                  â”‚
â”‚  â”‚                     â”‚              â”‚    performance      â”‚                  â”‚
â”‚  â”‚ POST: {             â”‚              â”‚                     â”‚                  â”‚
â”‚  â”‚   startDate,        â”‚              â”‚ POST: {             â”‚                  â”‚
â”‚  â”‚   endDate,          â”‚              â”‚   startDate,        â”‚                  â”‚
â”‚  â”‚   metrics,          â”‚              â”‚   endDate,          â”‚                  â”‚
â”‚  â”‚   dimensions        â”‚              â”‚   dimensions        â”‚                  â”‚
â”‚  â”‚ }                   â”‚              â”‚ }                   â”‚                  â”‚
â”‚  â”‚                     â”‚              â”‚                     â”‚                  â”‚
â”‚  â”‚ Returns:            â”‚              â”‚ Returns:            â”‚                  â”‚
â”‚  â”‚ â€¢ overview          â”‚              â”‚ â€¢ queries           â”‚                  â”‚
â”‚  â”‚ â€¢ topPages          â”‚              â”‚ â€¢ pages             â”‚                  â”‚
â”‚  â”‚ â€¢ trafficSources    â”‚              â”‚ â€¢ dates             â”‚                  â”‚
â”‚  â”‚ â€¢ metadata          â”‚              â”‚ â€¢ summary           â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            Service Layer                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚    GA4Service       â”‚              â”‚ SearchConsoleServiceâ”‚                  â”‚
â”‚  â”‚                     â”‚              â”‚                     â”‚                  â”‚
â”‚  â”‚ â€¢ initialize()      â”‚              â”‚ â€¢ getPerformance()  â”‚                  â”‚
â”‚  â”‚ â€¢ batchRunReports() â”‚              â”‚ â€¢ getSites()        â”‚                  â”‚
â”‚  â”‚ â€¢ processData()     â”‚              â”‚ â€¢ processData()     â”‚                  â”‚
â”‚  â”‚                     â”‚              â”‚                     â”‚                  â”‚
â”‚  â”‚ Uses:               â”‚              â”‚ Uses:               â”‚                  â”‚
â”‚  â”‚ â€¢ OAuth2 tokens     â”‚              â”‚ â€¢ OAuth2 tokens     â”‚                  â”‚
â”‚  â”‚ â€¢ Property ID       â”‚              â”‚ â€¢ Site URL          â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            Data Layer                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ ga4_connections â”‚  â”‚search_console_  â”‚  â”‚  analytics_     â”‚                 â”‚
â”‚  â”‚                 â”‚  â”‚   connections   â”‚  â”‚     cache       â”‚                 â”‚
â”‚  â”‚ â€¢ id            â”‚  â”‚                 â”‚  â”‚                 â”‚                 â”‚
â”‚  â”‚ â€¢ userId        â”‚  â”‚ â€¢ id            â”‚  â”‚ â€¢ cacheKey      â”‚                 â”‚
â”‚  â”‚ â€¢ dealershipId  â”‚  â”‚ â€¢ userId        â”‚  â”‚ â€¢ data (JSONB)  â”‚                 â”‚
â”‚  â”‚ â€¢ accessToken   â”‚  â”‚ â€¢ dealershipId  â”‚  â”‚ â€¢ expiresAt     â”‚                 â”‚
â”‚  â”‚ â€¢ refreshToken  â”‚  â”‚ â€¢ accessToken   â”‚  â”‚ â€¢ createdAt     â”‚                 â”‚
â”‚  â”‚ â€¢ propertyId    â”‚  â”‚ â€¢ refreshToken  â”‚  â”‚                 â”‚                 â”‚
â”‚  â”‚ â€¢ propertyName  â”‚  â”‚ â€¢ siteUrl       â”‚  â”‚                 â”‚                 â”‚
â”‚  â”‚ â€¢ expiresAt     â”‚  â”‚ â€¢ siteName      â”‚  â”‚                 â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         External APIs                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   Google Analytics  â”‚              â”‚  Google Search      â”‚                  â”‚
â”‚  â”‚        API v4       â”‚              â”‚   Console API       â”‚                  â”‚
â”‚  â”‚                     â”‚              â”‚                     â”‚                  â”‚
â”‚  â”‚ â€¢ analyticsdata     â”‚              â”‚ â€¢ webmasters        â”‚                  â”‚
â”‚  â”‚ â€¢ batchRunReports   â”‚              â”‚ â€¢ searchanalytics   â”‚                  â”‚
â”‚  â”‚ â€¢ OAuth2 flow       â”‚              â”‚ â€¢ OAuth2 flow       â”‚                  â”‚
â”‚  â”‚                     â”‚              â”‚                     â”‚                  â”‚
â”‚  â”‚ Endpoints:          â”‚              â”‚ Endpoints:          â”‚                  â”‚
â”‚  â”‚ /properties/{id}/   â”‚              â”‚ /sites/{url}/       â”‚                  â”‚
â”‚  â”‚ batchRunReports     â”‚              â”‚ searchAnalytics/    â”‚                  â”‚
â”‚  â”‚                     â”‚              â”‚ query               â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Data Flow                                          â”‚
â”‚                                                                                 â”‚
â”‚  User Interaction                                                               â”‚
â”‚        â”‚                                                                       â”‚
â”‚        â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                               â”‚
â”‚  â”‚ Date Range  â”‚                                                               â”‚
â”‚  â”‚ Selection   â”‚                                                               â”‚
â”‚  â”‚ or          â”‚                                                               â”‚
â”‚  â”‚ Dealership  â”‚                                                               â”‚
â”‚  â”‚ Change      â”‚                                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                               â”‚
â”‚        â”‚                                                                       â”‚
â”‚        â–¼                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ Clear Cache â”‚â”€â”€â”€â”€â–¶â”‚ Fetch Data  â”‚â”€â”€â”€â”€â–¶â”‚ Update UI   â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                             â”‚                                                 â”‚
â”‚                             â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Parallel API Calls                                  â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚  â”‚ GA4 API Call    â”‚              â”‚ Search Console  â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚              â”‚    API Call     â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ 1. Check Cache  â”‚              â”‚                 â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ 2. Validate     â”‚              â”‚ 1. Check Cache  â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚    Connection   â”‚              â”‚ 2. Validate     â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ 3. Call Google  â”‚              â”‚    Connection   â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚    Analytics    â”‚              â”‚ 3. Call Google  â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ 4. Process Data â”‚              â”‚    Search Con.  â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚ 5. Cache Result â”‚              â”‚ 4. Process Data â”‚                  â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚              â”‚ 5. Cache Result â”‚                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚                                                 â”‚
â”‚                             â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Data Transformation                                  â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  GA4 Raw Response          Search Console Raw Response                  â”‚   â”‚
â”‚  â”‚        â”‚                             â”‚                                  â”‚   â”‚
â”‚  â”‚        â–¼                             â–¼                                  â”‚   â”‚
â”‚  â”‚  transformGA4Response()      transformSearchConsoleResponse()           â”‚   â”‚
â”‚  â”‚        â”‚                             â”‚                                  â”‚   â”‚
â”‚  â”‚        â–¼                             â–¼                                  â”‚   â”‚
â”‚  â”‚  AnalyticsData                SearchConsoleData                         â”‚   â”‚
â”‚  â”‚  {                           {                                          â”‚   â”‚
â”‚  â”‚    overview: {                 queries: [...],                         â”‚   â”‚
â”‚  â”‚      dates: [...],             pages: [...],                           â”‚   â”‚
â”‚  â”‚      metrics: {                dates: [...],                           â”‚   â”‚
â”‚  â”‚        sessions: [...],        summary: {                              â”‚   â”‚
â”‚  â”‚        totalUsers: [...],        totalClicks,                          â”‚   â”‚
â”‚  â”‚        eventCount: [...]         totalImpressions,                     â”‚   â”‚
â”‚  â”‚      }                           averageCtr,                           â”‚   â”‚
â”‚  â”‚    },                            averagePosition                       â”‚   â”‚
â”‚  â”‚    topPages: [...],            }                                       â”‚   â”‚
â”‚  â”‚    trafficSources: [...],    }                                         â”‚   â”‚
â”‚  â”‚    metadata: {...}                                                     â”‚   â”‚
â”‚  â”‚  }                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚                                                 â”‚
â”‚                             â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      Component Rendering                                â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚  â”‚   Overview Tab  â”‚  â”‚  Traffic Tab    â”‚  â”‚ Search Console  â”‚         â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚      Tab        â”‚         â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Metric Cards  â”‚  â”‚ â€¢ Traffic Chart â”‚  â”‚ â€¢ Query Table   â”‚         â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Combined Chartâ”‚  â”‚ â€¢ Top Pages     â”‚  â”‚ â€¢ Page Rankings â”‚         â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Error States  â”‚  â”‚ â€¢ Traffic Srcs  â”‚  â”‚ â€¢ Performance   â”‚         â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚ â€¢ Error States  â”‚  â”‚   Chart         â”‚         â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚ â€¢ Error States  â”‚         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            Component Hierarchy                                  â”‚
â”‚                                                                                 â”‚
â”‚  ReportingPage                                                                  â”‚
â”‚  â”œâ”€â”€ Header                                                                     â”‚
â”‚  â”‚   â”œâ”€â”€ DealershipSelector                                                    â”‚
â”‚  â”‚   â”œâ”€â”€ DateRangeSelector                                                     â”‚
â”‚  â”‚   â””â”€â”€ RefreshButton                                                         â”‚
â”‚  â”‚                                                                             â”‚
â”‚  â””â”€â”€ Tabs                                                                      â”‚
â”‚      â”œâ”€â”€ TabsList                                                              â”‚
â”‚      â”‚   â”œâ”€â”€ TabsTrigger("overview")                                           â”‚
â”‚      â”‚   â”œâ”€â”€ TabsTrigger("traffic")                                            â”‚
â”‚      â”‚   â””â”€â”€ TabsTrigger("searchconsole")                                      â”‚
â”‚      â”‚                                                                         â”‚
â”‚      â”œâ”€â”€ TabsContent("overview")                                               â”‚
â”‚      â”‚   â””â”€â”€ OverviewTab                                                       â”‚
â”‚      â”‚       â”œâ”€â”€ MetricCards                                                   â”‚
â”‚      â”‚       â”‚   â”œâ”€â”€ Card(Total Sessions)                                     â”‚
â”‚      â”‚       â”‚   â”œâ”€â”€ Card(Unique Users)                                       â”‚
â”‚      â”‚       â”‚   â”œâ”€â”€ Card(Organic Sessions)                                   â”‚
â”‚      â”‚       â”‚   â””â”€â”€ Card(Avg CTR)                                            â”‚
â”‚      â”‚       â”‚                                                                â”‚
â”‚      â”‚       â””â”€â”€ CombinedChart                                                 â”‚
â”‚      â”‚           â”œâ”€â”€ Line(Sessions)                                            â”‚
â”‚      â”‚           â”œâ”€â”€ Line(Organic Sessions)                                    â”‚
â”‚      â”‚           â””â”€â”€ Line(Impressions Ã· 100)                                  â”‚
â”‚      â”‚                                                                         â”‚
â”‚      â”œâ”€â”€ TabsContent("traffic")                                                â”‚
â”‚      â”‚   â””â”€â”€ TrafficTab                                                        â”‚
â”‚      â”‚       â”œâ”€â”€ MetricCards                                                   â”‚
â”‚      â”‚       â”‚   â”œâ”€â”€ Card(Total Sessions)                                     â”‚
â”‚      â”‚       â”‚   â”œâ”€â”€ Card(Unique Users)                                       â”‚
â”‚      â”‚       â”‚   â””â”€â”€ Card(Page Views)                                         â”‚
â”‚      â”‚       â”‚                                                                â”‚
â”‚      â”‚       â”œâ”€â”€ TrafficTrendsChart                                            â”‚
â”‚      â”‚       â”‚   â”œâ”€â”€ Line(Sessions)                                            â”‚
â”‚      â”‚       â”‚   â””â”€â”€ Line(Users)                                              â”‚
â”‚      â”‚       â”‚                                                                â”‚
â”‚      â”‚       â”œâ”€â”€ TopPagesCard                                                  â”‚
â”‚      â”‚       â”‚   â””â”€â”€ Bar(Page Sessions)                                       â”‚
â”‚      â”‚       â”‚                                                                â”‚
â”‚      â”‚       â””â”€â”€ TrafficSourcesCard                                            â”‚
â”‚      â”‚           â””â”€â”€ Bar(Source Sessions)                                     â”‚
â”‚      â”‚                                                                         â”‚
â”‚      â””â”€â”€ TabsContent("searchconsole")                                          â”‚
â”‚          â””â”€â”€ SearchTab                                                         â”‚
â”‚              â”œâ”€â”€ MetricCards                                                   â”‚
â”‚              â”‚   â”œâ”€â”€ Card(Total Clicks)                                       â”‚
â”‚              â”‚   â”œâ”€â”€ Card(Total Impressions)                                  â”‚
â”‚              â”‚   â”œâ”€â”€ Card(Average CTR)                                        â”‚
â”‚              â”‚   â””â”€â”€ Card(Average Position)                                   â”‚
â”‚              â”‚                                                                â”‚
â”‚              â”œâ”€â”€ PerformanceChart                                              â”‚
â”‚              â”‚   â”œâ”€â”€ Line(Clicks)                                             â”‚
â”‚              â”‚   â”œâ”€â”€ Line(Impressions Ã· 10)                                   â”‚
â”‚              â”‚   â””â”€â”€ Line(Position Inverted)                                  â”‚
â”‚              â”‚                                                                â”‚
â”‚              â”œâ”€â”€ TopQueriesCard                                                â”‚
â”‚              â”‚   â””â”€â”€ Table(Query, Clicks, Impressions, CTR, Position)         â”‚
â”‚              â”‚                                                                â”‚
â”‚              â””â”€â”€ TopPagesCard                                                  â”‚
â”‚                  â””â”€â”€ Table(Page, Clicks, Impressions, CTR, Position)          â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Database Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Database Schema                                        â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                           â”‚
â”‚  â”‚     users       â”‚                                                           â”‚
â”‚  â”‚                 â”‚                                                           â”‚
â”‚  â”‚ â€¢ id (PK)       â”‚â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ â€¢ email         â”‚   â”‚                                                       â”‚
â”‚  â”‚ â€¢ name          â”‚   â”‚                                                       â”‚
â”‚  â”‚ â€¢ role          â”‚   â”‚                                                       â”‚
â”‚  â”‚ â€¢ agencyId      â”‚   â”‚                                                       â”‚
â”‚  â”‚ â€¢ dealershipId  â”‚   â”‚                                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                                       â”‚
â”‚                        â”‚                                                       â”‚
â”‚                        â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚ ga4_connections â”‚   â”‚   â”‚search_console_  â”‚                               â”‚
â”‚  â”‚                 â”‚   â”‚   â”‚   connections   â”‚                               â”‚
â”‚  â”‚ â€¢ id (PK)       â”‚   â”‚   â”‚                 â”‚                               â”‚
â”‚  â”‚ â€¢ userId (FK)   â”‚â”€â”€â”€â”˜   â”‚ â€¢ id (PK)       â”‚                               â”‚
â”‚  â”‚ â€¢ dealershipId  â”‚       â”‚ â€¢ userId (FK)   â”‚â”€â”€â”€â”                           â”‚
â”‚  â”‚ â€¢ accessToken   â”‚       â”‚ â€¢ dealershipId  â”‚   â”‚                           â”‚
â”‚  â”‚ â€¢ refreshToken  â”‚       â”‚ â€¢ accessToken   â”‚   â”‚                           â”‚
â”‚  â”‚ â€¢ propertyId    â”‚       â”‚ â€¢ refreshToken  â”‚   â”‚                           â”‚
â”‚  â”‚ â€¢ propertyName  â”‚       â”‚ â€¢ siteUrl       â”‚   â”‚                           â”‚
â”‚  â”‚ â€¢ expiresAt     â”‚       â”‚ â€¢ siteName      â”‚   â”‚                           â”‚
â”‚  â”‚ â€¢ createdAt     â”‚       â”‚ â€¢ expiresAt     â”‚   â”‚                           â”‚
â”‚  â”‚ â€¢ updatedAt     â”‚       â”‚ â€¢ createdAt     â”‚   â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â€¢ updatedAt     â”‚   â”‚                           â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                           â”‚
â”‚                                                  â”‚                           â”‚
â”‚                                                  â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚                           â”‚
â”‚  â”‚  dealerships    â”‚                             â”‚                           â”‚
â”‚  â”‚                 â”‚                             â”‚                           â”‚
â”‚  â”‚ â€¢ id (PK)       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚  â”‚ â€¢ name          â”‚                                                         â”‚
â”‚  â”‚ â€¢ website       â”‚                                                         â”‚
â”‚  â”‚ â€¢ agencyId      â”‚                                                         â”‚
â”‚  â”‚ â€¢ package       â”‚                                                         â”‚
â”‚  â”‚ â€¢ status        â”‚                                                         â”‚
â”‚  â”‚ â€¢ createdAt     â”‚                                                         â”‚
â”‚  â”‚ â€¢ updatedAt     â”‚                                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                         â”‚
â”‚                                                                               â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚ analytics_cache â”‚        â”‚    agencies     â”‚                             â”‚
â”‚  â”‚                 â”‚        â”‚                 â”‚                             â”‚
â”‚  â”‚ â€¢ id (PK)       â”‚        â”‚ â€¢ id (PK)       â”‚                             â”‚
â”‚  â”‚ â€¢ cacheKey      â”‚        â”‚ â€¢ name          â”‚                             â”‚
â”‚  â”‚ â€¢ data (JSONB)  â”‚        â”‚ â€¢ slug          â”‚                             â”‚
â”‚  â”‚ â€¢ expiresAt     â”‚        â”‚ â€¢ domain        â”‚                             â”‚
â”‚  â”‚ â€¢ createdAt     â”‚        â”‚ â€¢ plan          â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â€¢ status        â”‚                             â”‚
â”‚                             â”‚ â€¢ createdAt     â”‚                             â”‚
â”‚                             â”‚ â€¢ updatedAt     â”‚                             â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## API Response Formats

### GA4 Analytics Response Structure

```json
{
  "data": {
    "overview": {
      "dates": ["2024-01-01", "2024-01-02", "..."],
      "metrics": {
        "sessions": [245, 198, 267, "..."],
        "totalUsers": [208, 168, 227, "..."],
        "eventCount": [612, 495, 668, "..."]
      }
    },
    "topPages": [
      {
        "page": "/",
        "sessions": 1800,
        "eventCount": 4400
      },
      {
        "page": "/inventory",
        "sessions": 1520,
        "eventCount": 3800
      }
    ],
    "trafficSources": [
      {
        "source": "google",
        "sessions": 2600
      },
      {
        "source": "(direct)",
        "sessions": 1520
      }
    ],
    "metadata": {
      "propertyId": "123456789",
      "propertyName": "Dealership Property",
      "dateRange": {
        "startDate": "2024-01-01",
        "endDate": "2024-01-31"
      }
    }
  },
  "cached": false
}
```

### Search Console Response Structure

```json
{
  "data": {
    "queries": [
      {
        "query": "toyota dealer near me",
        "clicks": 143,
        "impressions": 2250,
        "ctr": 0.065,
        "position": 3.7
      }
    ],
    "pages": [
      {
        "page": "https://dealership.com/",
        "clicks": 195,
        "impressions": 3000,
        "ctr": 0.065,
        "position": 2.1
      }
    ],
    "dates": [
      {
        "date": "2024-01-01",
        "clicks": 45,
        "impressions": 680,
        "ctr": 0.066,
        "position": 4.2
      }
    ],
    "summary": {
      "totalClicks": 872,
      "totalImpressions": 14500,
      "averageCtr": 0.058,
      "averagePosition": 5.5
    }
  },
  "metadata": {
    "siteUrl": "https://dealership.com/",
    "dateRange": {
      "startDate": "2024-01-01",
      "endDate": "2024-01-31"
    }
  },
  "cached": false
}
```

## OAuth Flow Diagrams

### GA4 Authentication Flow

```
User                    App                     Google OAuth            GA4 API
  â”‚                      â”‚                          â”‚                     â”‚
  â”‚â”€â”€â”€â”€ Click Connect â”€â”€â”€â–¶â”‚                          â”‚                     â”‚
  â”‚                      â”‚â”€â”€â”€â”€â”€ Generate URL â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚
  â”‚                      â”‚                          â”‚                     â”‚
  â”‚â—€â”€â”€â”€â”€ Redirect â”€â”€â”€â”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€ Auth URL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚
  â”‚                      â”‚                          â”‚                     â”‚
  â”‚â”€â”€â”€â”€ Login & Approve â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚
  â”‚                      â”‚                          â”‚                     â”‚
  â”‚â—€â”€â”€â”€â”€ Callback â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚
  â”‚      (with code)     â”‚                          â”‚                     â”‚
  â”‚                      â”‚â”€â”€â”€â”€â”€ Exchange Code â”€â”€â”€â”€â”€â–¶â”‚                     â”‚
  â”‚                      â”‚                          â”‚                     â”‚
  â”‚                      â”‚â—€â”€â”€â”€â”€ Access Token â”€â”€â”€â”€â”€â”€â”‚                     â”‚
  â”‚                      â”‚                          â”‚                     â”‚
  â”‚                      â”‚â”€â”€â”€ Store in Database â”€â”€â”€â”€â”‚                     â”‚
  â”‚                      â”‚                          â”‚                     â”‚
  â”‚                      â”‚â”€â”€â”€â”€â”€â”€ Test API Call â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                      â”‚                          â”‚                     â”‚
  â”‚                      â”‚â—€â”€â”€â”€â”€â”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                      â”‚                          â”‚                     â”‚
  â”‚â—€â”€â”€â”€ Success Page â”€â”€â”€â”€â”‚                          â”‚                     â”‚
```

### Data Fetching Flow

```
Component               API Handler              Service Layer           External API
    â”‚                      â”‚                        â”‚                       â”‚
    â”‚â”€â”€â”€â”€ fetchGA4Data â”€â”€â”€â”€â–¶â”‚                        â”‚                       â”‚
    â”‚                      â”‚â”€â”€â”€â”€ Validate Auth â”€â”€â”€â”€â–¶â”‚                       â”‚
    â”‚                      â”‚                        â”‚                       â”‚
    â”‚                      â”‚â—€â”€â”€â”€â”€ User Valid â”€â”€â”€â”€â”€â”€â”‚                       â”‚
    â”‚                      â”‚                        â”‚                       â”‚
    â”‚                      â”‚â”€â”€â”€â”€ Get Connection â”€â”€â”€â–¶â”‚                       â”‚
    â”‚                      â”‚                        â”‚                       â”‚
    â”‚                      â”‚â—€â”€â”€â”€â”€ GA4 Tokens â”€â”€â”€â”€â”€â”€â”‚                       â”‚
    â”‚                      â”‚                        â”‚                       â”‚
    â”‚                      â”‚â”€â”€â”€â”€ Initialize â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                       â”‚
    â”‚                      â”‚                        â”‚                       â”‚
    â”‚                      â”‚                        â”‚â”€â”€â”€â”€ Batch Request â”€â”€â”€â–¶â”‚
    â”‚                      â”‚                        â”‚                       â”‚
    â”‚                      â”‚                        â”‚â—€â”€â”€â”€â”€ Raw Data â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                      â”‚                        â”‚                       â”‚
    â”‚                      â”‚â—€â”€â”€â”€â”€ Process Data â”€â”€â”€â”€â”‚                       â”‚
    â”‚                      â”‚                        â”‚                       â”‚
    â”‚â—€â”€â”€â”€â”€ Formatted â”€â”€â”€â”€â”€â”€â”‚                        â”‚                       â”‚
    â”‚      Response        â”‚                        â”‚                       â”‚
```

This architecture documentation provides the complete visual blueprint of how all the components, data flows, and integrations work together in the analytics system.